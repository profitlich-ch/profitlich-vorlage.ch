{% macro bild (
    bild,
    class,
    bildbeschreibung,
    bildverhaeltnis = false,
    lazyload = true,
    paddingTrick = true,
    preload = false,
    hintergrundfarbe = false,
    fokuspunkt = 5
) %}

{% if bild is not defined %}
    Utility bild: Kein Bild (bild) angegeben.
{% endif %}
{% if class is not defined %}
    Utility bild: Keine Klasse (class) angegeben.
{% endif %}

{% if lazyload == true %}
    {% set lazyloadVariable = "lazyload" %}
    {% set srcset = "data-srcset" %}
    {% set sizesAuto = "auto" %}
{% else %}
    {% set lazyloadVariable = false %}
    {% set srcset = "srcset" %}
    {% set sizesAuto = false %}
{% endif %}

{% if bildverhaeltnis == true %}
    {% set paddingBottom = bildverhaeltnis * 100 ~ "%" %}
{% else %}
    {% set paddingBottom = bild.getHeight() // bild.getWidth() * 100 | round(2) ~ "%" %}
{% endif %}

{% switch fokuspunkt %}
    {% case 1 %}
        {% set cssObjectPosition = 'left top' %}
    {% case 2 %}
        {% set cssObjectPosition = 'center top' %}
    {% case 3 %}
        {% set cssObjectPosition = 'right top' %}
    {% case 4 %}
        {% set cssObjectPosition = 'left center' %}
    {% case 5 %}
        {% set cssObjectPosition = 'center center' %}
    {% case 6 %}
        {% set cssObjectPosition = 'right center' %}
    {% case 7 %}
        {% set cssObjectPosition = 'left bottom' %}
    {% case 8 %}
        {% set cssObjectPosition = 'center bottom' %}
    {% case 9 %}
        {% set cssObjectPosition = 'right bottom' %}
{% endswitch %}
        
{# mit/ohne preload #}
{# mit/ohne padding-bottom-Trick #}
    {# object-fit #}
{# Preload #}
    
{# Fallunterscheidung preload, kein Padding-bottom-Trick, Standard weggelassen #}
{# Sp√§ter aus xsl holen und umprogrammieren #}

{% set attribute = {
    class: [
        'bild-verhaeltnis'
    ],
    style: {
        'background-color': hintergrundfarbe,
        'padding-bottom': paddingBottom
    }
} %}

<div {{attr(attribute)}}>
    <picture>
        {% if bildverhaeltnis == true %}
            {% do bild.setTransform({ width: 100, height: 100 * bildverhaeltnis }) %}
            {{ tag('source', {
                format: 'webp',
                mode: 'crop',
                type: 'image/webp',
                srcset: bild.getSrcset(['100w', '200w', '400w', '600w', '800w', '1000w', '1200w', '1400w', '1600w', '1800w', '2000w', '2200w', '2400w', '2600w', '2800w', '3000w', '3200w', '3400w', '3600w', '3800w', '4000w', '4200w', '4400w', '4600w', '4800w', '5000w'])
            }) }}
            {{ tag('source', {
                format: 'jpg',
                mode: 'crop',
                type: 'image/jpeg',
                srcset: bild.getSrcset(['100w', '200w', '400w', '600w', '800w', '1000w', '1200w', '1400w', '1600w', '1800w', '2000w', '2200w', '2400w', '2600w', '2800w', '3000w', '3200w', '3400w', '3600w', '3800w', '4000w', '4200w', '4400w', '4600w', '4800w', '5000w'])
            }) }}
        {% else %}
            {% do bild.setTransform({ width: 100, height: bild.width * bildverhaeltnis }) %}
            {{ tag('source', {
                format: 'webp',
                mode: 'fit',
                type: 'image/webp',
                srcset: bild.getSrcset(['100w', '200w', '400w', '600w', '800w', '1000w', '1200w', '1400w', '1600w', '1800w', '2000w', '2200w', '2400w', '2600w', '2800w', '3000w', '3200w', '3400w', '3600w', '3800w', '4000w', '4200w', '4400w', '4600w', '4800w', '5000w'])
            }) }}
            {{ tag('source', {
                format: 'jpg',
                mode: 'fit',
                type: 'image/jpeg',
                srcset: bild.getSrcset(['100w', '200w', '400w', '600w', '800w', '1000w', '1200w', '1400w', '1600w', '1800w', '2000w', '2200w', '2400w', '2600w', '2800w', '3000w', '3200w', '3400w', '3600w', '3800w', '4000w', '4200w', '4400w', '4600w', '4800w', '5000w'])
            }) }}
        {% endif %}

        {% do bild.setTransform({ width: 300, height: 300 }) %}
        {{ tag('img', {
            src: bild.url,
            width: bild.width,
            height: bild.height,
            alt: bildbeschreibung,
            class: class ~ '__img' ~ lazyloadVariable,
            'background-color': hintergrundfarbe,
            'padding-bottom': paddingBottom,
            'object-position': cssObjectPosition,
            data: {
                sizes: sizesAuto
            }
        }) }}
    </picture>
</div>


{% endmacro %}